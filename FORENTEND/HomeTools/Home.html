<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../CSSPAge/HomePage.css" rel="stylesheet">
    <title>Todo List - Home</title>
</head>

<body>
    <!-- Sidebar with navigation icons -->
    <div class="SiderBar">
        <img class="nav-icon active" src="https://img.icons8.com/3d-fluency/375/home.png" alt="home" title="Home" onclick="navigateTo('Home.html')" />
        <img class="nav-icon" src="https://img.icons8.com/cute-clipart/64/overtime.png" alt="tasks" title="WorkSpace" onclick="navigateTo('WorkSpace.html')" />
        <img class="nav-icon" src="https://img.icons8.com/3d-fluency/94/tear-off-calendar.png" alt="calendar" title="Schedule" onclick="navigateTo('Schedule.html')" />
        <img class="nav-icon" src="https://img.icons8.com/3d-fluency/94/source-code.png" alt="ide" title="IDE" onclick="navigateTo('IDE.html')" />
        <img class="nav-icon" src="https://img.icons8.com/3d-fluency/94/gear--v1.png" alt="settings" title="Settings" onclick="navigateTo('Settings.html')" />
    </div>

    <!-- Main content area -->
    <div class="main-content">
        <div class="header">
            <h1>Welcome to Your Todo List</h1>
            <p>Stay organized and productive!</p>
            <button id="logoutBtn" style="position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: #ff4757; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">Logout</button>
        </div>
        
        <div class="todo-container">
            <div class="add-todo">
                <input type="text" placeholder="Add a new task..." id="todoInput" />
                <button id="addBtn">Add Task</button>
            </div>
            
            <div class="todo-stats">
                <div class="stat-card">
                    <span class="stat-number">0</span>
                    <span class="stat-label">Total Tasks</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">0</span>
                    <span class="stat-label">Completed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">0</span>
                    <span class="stat-label">Remaining</span>
                </div>
            </div>
            
            <div class="todo-list" id="todoList">
                <!-- Todo items will be added here -->
            </div>
        </div>
    </div>

    <script>
        // Check authentication on page load
        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('loggedInUser');
            
            if (!token || !user) {
                // No token or user info, redirect to landing page
                window.location.href = '/LandingPage.html';
                return false;
            }
            
            // Display welcome message with user name
            try {
                const userData = JSON.parse(user);
                const header = document.querySelector('.header h1');
                if (header && userData) {
                    // Use email if name is "buddy" or empty
                    let displayName = userData.name || '';
                    if (displayName.toLowerCase() === 'buddy' || displayName.trim() === '') {
                        displayName = userData.email ? userData.email.split('@')[0] : 'User';
                    }
                    header.textContent = `Welcome back, ${displayName}!`;
                }
            } catch (e) {
                console.error('Error parsing user data:', e);
            }
            
            return true;
        }

        // Check auth when page loads
        if (!checkAuth()) {
            // Stop script execution if not authenticated
            throw new Error('Not authenticated');
        }

        // Logout functionality
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                // Clear all stored data
                localStorage.removeItem('token');
                localStorage.removeItem('loggedInUser');
                
                // Redirect to login page
                alert('✅ Logged out successfully!');
                window.location.href = '/REgisterPage.html';
            });
        }

        // Add click handlers for navigation
        document.querySelectorAll('.nav-icon').forEach(icon => {
            icon.addEventListener('click', function() {
                // Remove active class from all icons
                document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
                // Add active class to clicked icon
                this.classList.add('active');
            });
        });

        // Simple todo functionality
        const todoInput = document.getElementById('todoInput');
        const addBtn = document.getElementById('addBtn');
        const todoList = document.getElementById('todoList');

        addBtn.addEventListener('click', addTodo);
        todoInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addTodo();
        });

        function addTodo() {
            const text = todoInput.value.trim();
            if (text) {
                const todoItem = document.createElement('div');
                todoItem.className = 'todo-item';
                todoItem.innerHTML = `
                    <span class="todo-text">${text}</span>
                    <button class="delete-btn" onclick="removeTodo(this)">×</button>
                `;
                todoList.appendChild(todoItem);
                todoInput.value = '';
                updateStats();
            }
        }

        function removeTodo(btn) {
            btn.parentElement.remove();
            updateStats();
        }

        function updateStats() {
            const total = document.querySelectorAll('.todo-item').length;
            document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = total;
            document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = total;
        }

        // Navigation function
        function navigateTo(page) {
            window.location.href = page;
        }
    </script>
</body>

</html>